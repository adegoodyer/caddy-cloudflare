# Caddy with Cloudflare DNS

[![Docker Pulls](https://img.shields.io/docker/pulls/adegoodyer/caddy-cloudflare)](https://hub.docker.com/r/adegoodyer/caddy-cloudflare)
[![Docker Image Size](https://img.shields.io/docker/image-size/adegoodyer/caddy-cloudflare/latest)](https://hub.docker.com/r/adegoodyer/caddy-cloudflare)
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
![SBOM](https://img.shields.io/badge/SBOM-Syft-blue)
![Scanned with](https://img.shields.io/badge/Scanned%20with-Grype-blue)
[![Critical Vulnerabilities](https://img.shields.io/github/issues/adegoodyer/caddy-cloudflare/Critical%20Vulnerabilities?label=Critical%20CVEs&color=red)](https://github.com/adegoodyer/caddy-cloudflare/issues?q=is%3Aissue+is%3Aopen+label%3A%22Critical+Vulnerabilities%22)

Custom Caddy server Docker image with built-in Cloudflare DNS module for DNS-01 ACME validation. Automatically updated when new Caddy versions are released.

## Features

- Based on official Caddy image
- Includes Cloudflare DNS module for DNS-01 ACME validation
- Multi-platform build (amd64 and arm64)
- Automated builds via GitHub Actions
- Regular security scanning (Grype) and SBOM generation (Syft)
- Automated updates when new Caddy versions are released
- Published to Docker Hub

## Usage

### Pull the image

```bash
docker pull adegoodyer/caddy-cloudflare:latest
```

### Run with Docker

```bash
docker run -d \
  --name caddy \
  -p 80:80 \
  -p 443:443 \
  -v caddy_data:/data \
  -v caddy_config:/config \
  -v ./Caddyfile:/etc/caddy/Caddyfile \
  adegoodyer/caddy-cloudflare:latest
```

### Docker Compose

```yaml
version: '3.8'

services:
  caddy:
    image: adegoodyer/caddy-cloudflare:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - caddy_data:/data
      - caddy_config:/config
      - ./Caddyfile:/etc/caddy/Caddyfile
    environment:
      - CLOUDFLARE_API_TOKEN=your_token_here
    restart: unless-stopped

volumes:
  caddy_data:
  caddy_config:
```

### Example Caddyfile

```caddyfile
{
    email your@email.com
    acme_dns cloudflare {$CLOUDFLARE_API_TOKEN}
}

example.com {
    respond "Hello, world!"
}
```

## Automated Updates

This image is automatically updated when new versions of Caddy are released:
- Checks for updates every 6 hours
- Builds and pushes new versions automatically
- Generates SBOM and security scans for each release
- Creates GitHub releases with scan results and SBOM

## Security

Each build includes:
- Software Bill of Materials (SBOM) generated by Syft
- Vulnerability scanning by Grype
- Results attached to each GitHub release
- Automatic issue creation for critical vulnerabilities
- Security scan results in GitHub Security tab

## Building Locally

```bash
docker build -t caddy-cloudflare .
```

## Tags

- `latest`: Most recent stable build
- `x.y.z`: Specific version builds (e.g., `2.7.5`)
- `x.y`: Minor version builds (e.g., `2.7`)

## Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## GitHub Actions Workflows

This repository includes two GitHub Actions workflows:

1. `check-updates.yml`: Automatically checks for new Caddy versions and builds new images
2. `docker-build.yml`: Handles manual builds and pull request verification

### Required Secrets

Add these to your GitHub repository secrets:
- `DOCKER_USERNAME`: Your Docker Hub username
- `DOCKER_TOKEN`: Your Docker Hub access token

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

### Included Software Licenses
- [Caddy](https://github.com/caddyserver/caddy) (Apache-2.0)
- [caddy-dns/cloudflare](https://github.com/caddy-dns/cloudflare) (MIT)

## Acknowledgments

- [Caddy Web Server](https://caddyserver.com/)
- [Cloudflare DNS Plugin](https://github.com/caddy-dns/cloudflare)
- [Syft](https://github.com/anchore/syft)
- [Grype](https://github.com/anchore/grype)